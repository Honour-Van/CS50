# 基于网页的可视化

> 程序设计思维作业 0429

1900012739 范皓年 电子学系

## description

>based on echarts

对地铁数据进行分析之后的可视化分析。

数据见 data，数据是北京地铁刷卡数据。第一行是数据标题，其含义如下：

- a) carType：SUB 是唯一取值，表明数据是地铁，本次作业可以不用；
- b) icID：交通卡编号，每个编号对应一张卡，已经消密脱敏；
- c) cardType：卡类型
- d) tradeType：交易类型
- e) UpLine：上车线路编号
- f) UpTime：上车时间
- g) UpStation：上车站编号
- h) DownLine：下车线路编号
- i) DownTime：下车时间
- j) DownStation：下车站编号
- k) State：弃用

压缩包内的 PDF 文档是地铁线路编号和车站编号，供参考。

为便于程序调试，数据中有 Subway_20190301_top100000.txt(实际上是 Subway_20180301_top100000.txt，误为 2019)，是 Subway_20180301.txt 的前 100000 行数据，可以用于初步调试程序，待调试完毕后再用完整数据跑，节省时间

## task

### task1

计算乘车耗时时段内的人数。每条记录是一次乘车行为，下车时间减去上车时间，即为耗时，题目要求统计耗时 10 分钟有多少人，耗时 15 分钟有多少人。以分钟为单位，计算出每个时间段内的人数。如 1 分钟：10 人，2 分钟 20 人，……，10 分钟 500 人，30 分钟 5000 人。计算耗时，用 round()函数四舍五入到分中。对下车时间早于或等于上车时间的数据予以清除，对超过 120 分钟的数据予以清除，对于不是 20180301 的数据清除。输出时，按耗时升序排序输出到 PeopleInSubwayTime.txt，并在 Excel 中打开该文件，形成条形图。

### task2

所有地铁内人数时间分布。以 10 分钟为间隔，统计地铁内人数多少。进站相当于人数增加，出站相当于人数减少。以凌晨 00:00 开始计数，此刻人数为 0。统计 00:00-00:09,00:10-00:19，以此类推，要求标记为：00:00-00:00,00:10-00:19（以下同）。清除数据的规则与 5 相同。按时间自然升序输出到 PeopleInSubwayCount.txt，形成折线图；

### task3

利用两个数据文件，通过 Python+Flask 模式，将数据输出到网页，利用 eCharts 显示出形如 Excel 的统计图。每个统计图都支持柱状图和折线图切换；

### task4

利用两个数据文件，通过包含 JS 数据文件方式，显示出形如 Excel 的统计图。与 task3 页面要求一致，仅数据源不同而已。

## design

总述：时间为主要因素，从而构建一个时间的提取函数。从而完成 task 1，由于只有 5M+条记录，所以我们可以直接将每一个记录直接映射到时间轴上，从而完成 task 2。得到两组比较简单的线性图样，随后进行 flask 的 web 投送，和

### 时间提取

不正则数据：

- 下车早于上车
- 消除不在当日的数据
- 清除前后超过 120 分钟的数据

返回上车和下车时间即可，上述的工作可以交由具体实现时。

第二次决定加入时间差作为第三个返回值

### 时间轴统计

如果记录的进入离开时间在特定范围内，记增减。注意每次要加前一次的

### 重要知识点回顾

表示进度：https://blog.csdn.net/lwgkzl/article/details/80988126

dataframe 更名：https://blog.csdn.net/weixin_43745169/article/details/89306686

dataframe 定位：https://blog.csdn.net/W_weiying/article/details/81411257

datetime 的使用方法：

- `strptime()`函数
- `timedelta`类型

不会把 python 列表直接变成 js 中的变量，从而使用了复制粘贴

## 文件结构说明

`data`中包含地铁记录信息，其中完整版数据因为大于100M，无法上传到Github端，直接删除掉。

`out`文件夹中为第5,6题中的数据，其中数据输出到csv文件中，而图表绘制在xlsx中。

`static`文件夹为flask相关组件，包括几个工具组件、静态页面以及数据文件mydata

`range_stat.py`对应第五题

`online_stat.py`对应第六题。

`webvis.py`对应第七题，在flask端获取dataframe并通过jsonify方法传递到网页端。

`visjs.py`对应第八题，直接从js文件中获取变量。